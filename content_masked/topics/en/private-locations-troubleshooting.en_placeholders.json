{
  "[URL_BASE_TOPICS]": "/support/kb/",
  "[FRONTMATTER_TRANSLATIONKEY]": "https://www.uptrends.com/support/kb/synthetic-monitoring/checkpoints/private-locations/private-locations-troubleshooting",
  "[LINK_URL_1]": "#verify-private-location-installation",
  "[LINK_URL_2]": "#smoke-test-your-setup",
  "[LINK_URL_3]": "#how-to-troubleshoot",
  "[LINK_URL_4]": "{{< ref path=\"support/kb/synthetic-monitoring/checkpoints/private-locations/install-docker-private-checkpoints#installation-steps\" lang=\"en\" >}}",
  "[LINK_URL_5]": "{{< ref path=\"support/kb/synthetic-monitoring/checkpoints/private-locations/install-docker-private-checkpoints#installation-script\" lang=\"en\" >}}",
  "[LINK_URL_6]": "#managing-running-containers",
  "[LINK_URL_7]": "{{< ref path=\"support/kb/synthetic-monitoring/checkpoints/private-locations/private-checkpoints-update-containers\" lang=\"en\" >}}",
  "[LINK_URL_8]": "{{< ref path=\"support/kb/synthetic-monitoring/checkpoints/private-locations/private-locations-data-protection\" lang=\"en\" >}}",
  "[LINK_URL_9]": "#dns-issues",
  "[LINK_URL_10]": "{{< ref path=\"support/kb/synthetic-monitoring/checkpoints/private-locations/private-locations-how-to-use#disable-a-private-checkpoint\" lang=\"en\" >}}",
  "[LINK_URL_11]": "{{< ref path=\"support/kb/synthetic-monitoring/checkpoints/private-locations/private-locations-checkpoint-health\" lang=\"en\" >}}",
  "[LINK_URL_12]": "{{< ref path=\"/support/kb/synthetic-monitoring/checkpoints/private-locations/install-docker-private-checkpoints\" lang=\"en\" >}}",
  "[LINK_URL_13]": "https://docs.docker.com/engine/manage-resources/pruning",
  "[LINK_URL_14]": "{{< ref path=\"contact\" lang=\"en\" >}}",
  "[SHORTCODE_1]": "{{< callout >}}",
  "[SHORTCODE_2]": "{{< /callout >}}",
  "[SHORTCODE_3]": "{{< callout >}}",
  "[SHORTCODE_4]": "{{< /callout >}}",
  "[SHORTCODE_5]": "{{< AppElement type=\"buttonSecondary\" >}}",
  "[SHORTCODE_6]": "{{< /AppElement >}}",
  "[SHORTCODE_7]": "{{< AppElement type=\"buttonSecondary\" >}}",
  "[SHORTCODE_8]": "{{< /AppElement >}}",
  "[CODE_BLOCK_1]": "```Docker exec -i checkpoint powershell```",
  "[CODE_BLOCK_2]": "```Docker exec -i checkpoint cmd```",
  "[CODE_BLOCK_3]": "```winver : The term 'winver' is not recognized```",
  "[CODE_BLOCK_4]": "```yaml\nTransactionProcessor:\n    container_name: TransactionProcessor\n    image: uptrends.azurecr.io/win2022/transaction-processor\n    deploy:\n      restart_policy:\n        condition: always\n    volumes:\n      - .\\Certificates:C:\\Uptrends\\Certificates:ro\n    logging:\n      driver: local\n    environment:\n      - ServerId=\n      - Password=\n    dns:\n      - 1.2.3.4\n      - 2.3.4.5\n```",
  "[INLINE_CODE_1]": "`Get-WindowsFeature | Where-Object {$_. installstate -eq \"installed\"}`",
  "[INLINE_CODE_2]": "`. \n3. Check if this list includes 'Containers'\n\nSecond, check the output of the version of Docker:\n1. Open a PowerShell console in admin mode. \n2. Go to the folder where the docker-compose.yml file lives and execute the following command `",
  "[INLINE_CODE_3]": "`Docker -v`",
  "[INLINE_CODE_4]": "`. \n3. The result should read something like 'Docker version 23.0.3, build 3e7cbfd'\n\nThirdly, check the output of the version of Docker Compose:\n1. Open a PowerShell console in admin mode. \n2. Go to the folder where the docker-compose.yml file lives and execute the following command `",
  "[INLINE_CODE_5]": "`Docker-compose -v`",
  "[INLINE_CODE_6]": "`. \n3. The result should read something like 'Docker Compose version v2.17.2'\n\nIf you think anything is out of order you can refer to the installation script, install-checkpoint.ps1, and manually run the individual parts for the components above and examine the output.\n \n### Container images\nIf all three prerequisites above are in place the [installation script]([LINK_URL_5]) will start to pull the Uptrends container images from Azure. These images are large since each includes a compressed installation of Windows Server. The download can take at least several minutes (20 minutes is common) depending on the network throughput. Parts of the images are re-used when updating so subsequent downloads will be faster. Once the downloading is done, you can verify this by [running]([LINK_URL_6]): `",
  "[INLINE_CODE_7]": "`docker images`",
  "[INLINE_CODE_8]": "` and expect to see three entries.\n\nPulling the images relies on the inner workings of Docker and is a robust process which can handle connections dropping. If downloading fails altogether the most expected cause is a (local) firewall preventing Docker from accessing the Azure Container Repository via azurecr.io, hosted by Microsoft.\n\nTo authenticate when pulling the images, the installation script will register credentials via Docker login. In case of issues with authentication you can navigate to the installation directory (the folder that contains install-checkpoint.ps1) and run these commands in powershell to:\n\nClear existing credentials, use the following command:\n`",
  "[INLINE_CODE_9]": "`Docker logout`",
  "[INLINE_CODE_10]": "`\n\nRe-run registry-login.ps1 and examine the output of this command use the following command:\n`",
  "[INLINE_CODE_11]": "`.\\registry-login.ps1`",
  "[INLINE_CODE_12]": "`\n\n### Auto-run and auto-updates\nTo keep the container checkpoints running a scheduled task is created to run the script start-containers.ps1 after startup of the server. To keep the container checkpoint Docker images [up to date]([LINK_URL_7])  a second Scheduled Task is created to check for image updates on a regular interval. Check the output of the powershell command `",
  "[INLINE_CODE_13]": "`Get-ScheduledTask`",
  "[INLINE_CODE_14]": "` to verify if these tasks exist. They are called 'Start Checkpoint Containers' and 'Update Checkpoint Images'. \n\nYou can use the Windows Scheduled Task user interface to further examine the tasks, run history and failures or manually trigger the task to troubleshoot. Again, in case of issues, use the installation script (install-checkpoint.ps1) to manually re-run this part of the installation if needed.\n\n### Configuration\nAll server-specific configuration will be in the Docker-compose.yml config file. This file lists all three container images and their individual settings. This configuration file comes pre-filled with all necessary settings when it is being downloaded. Most important is the `",
  "[INLINE_CODE_15]": "`ServerId/Password`",
  "[INLINE_CODE_16]": "` combination that should be configured for all three of the container images listed in the file (meaning the same combination of credentials will be in the yml file thrice with the same values). \n\n[SHORTCODE_1] The *ServerId* and *Password* are unique to the container checkpoint. Multiple container checkpoint servers should never have the same *ServerId*.\n[SHORTCODE_2] \n\nThe Docker Compose file can be used to configure checkpoint specific [data protection]([LINK_URL_8]) policies and [environment specific DNS rules]([LINK_URL_9]).\n \n### Current status\nAfter installation, the containers for all three images are started and these containers are expected to always be running. You can verify their status with the command `",
  "[INLINE_CODE_17]": "`docker ps`",
  "[INLINE_CODE_18]": "` and check the right-most column to see if the containers are indeed running. In case of issues use these commands to obtain log files for further diagnosis:\n\n\n- Get the current status for all containers\n`",
  "[INLINE_CODE_19]": "`Docker ps`",
  "[INLINE_CODE_20]": "`\n\n- Get the logs for the checkpoint Agent container and write to file\n`",
  "[INLINE_CODE_21]": "`Docker logs Checkpoint | Out-File Docker_CS.txt`",
  "[INLINE_CODE_22]": "`\n\n- Get the logs for the transaction processor container and write to file\n`",
  "[INLINE_CODE_23]": "`Docker logs TransactionProcessor | Out-File Docker_TP.txt`",
  "[INLINE_CODE_24]": "`\n\n- Alternatively, get combined logs for all containers\n`",
  "[INLINE_CODE_25]": "`Docker-compose logs -t -n 5000 | Out-File Docker.txt`",
  "[INLINE_CODE_26]": "`\n\n## Smoke test your setup\n\nOnce container checkpoints are installed, they are immediately ready to run measurements. Uptrends' internal processes will automatically switch the maintenance status of a container checkpoint based on its health. A healthy checkpoint is switched to active, an unhealthy checkpoint to maintenance. \n\nCheckpoints update their health each minute. Also, you can enable or [disable]([LINK_URL_10]) checkpoints (for instance when doing maintenance or testing their setup) from the private locations UI in the Uptrends web application. The default state is 'enabled'. \n\nTo smoke test a container checkpoint the most convenient way is by using the [SHORTCODE_5] Test now [SHORTCODE_6] button. Ideally you would do this for each monitor type you intend to run on it. \n\nYou can use the private locations' [Checkpoint health]([LINK_URL_11]) to diagnose the status of unhealthy checkpoints. \n\nNote that all measurements run ‘inside’ a container, you will not see a browser being started on the host machine when using the [SHORTCODE_7] Test now [SHORTCODE_8] button for an FPC or transaction.\n\nAlso note that when adding a checkpoint to an existing private location that is part of the checkpoint selection of active monitors, the new checkpoint will start doing measurements after the installation finishes. If that is undesired (for instance if you want to test first) you should disable the checkpoint in the Uptrends private locations section.\n\n\n## How to troubleshoot\n\n### Stop, start, or restart a set of containers\nRestart containers associated with the Docker-compose.yaml file in the current directory. This often is the C:\\uptrends\\ folder:\n\n1. Open a PowerShell console in admin mode. \n2. Go to the folder where the docker-compose.yml file lives and execute one or all of the following commands.\n- To start type `",
  "[INLINE_CODE_27]": "` in the command-line. \n- To stop type `",
  "[INLINE_CODE_28]": "` in the command-line. \n- To restart type `",
  "[INLINE_CODE_29]": "` in the command-line.\n\n\n[SHORTCODE_3] **Tip,** use the Docker help. For any of the commands you can learn more by using the *docker - -help* command. This command will display all commands with generic help for all the different commands. You can request help on a certain command, as well, by typing *docker image - -help*.[SHORTCODE_4]\n\n\n### Managing running containers\nTo get a list of running containers execute the `",
  "[INLINE_CODE_30]": "`docker ps`",
  "[INLINE_CODE_31]": "` command. Here a containerId will be listed that can be used in other commands regarding this container. \n\nTo get a list of all local images run the command `",
  "[INLINE_CODE_32]": "`docker images`",
  "[INLINE_CODE_33]": "` Note the plural images, all commands targeting an image are ran against image (singular)\n\nImages can get quite large, to free up some space you can use `",
  "[INLINE_CODE_34]": "`docker image prune`",
  "[INLINE_CODE_35]": "` to remove images no longer used by active containers. Or use `",
  "[INLINE_CODE_36]": "`docker image rm <containerid>`",
  "[INLINE_CODE_37]": "` to remove a specific container.\n\n### Removing unused Docker objects\n\nThe [Uptrends installation script for Private locations]([LINK_URL_12]) does not include a setup for automatically cleaning up unused Docker objects. To remove unused Docker objects, refer to the [Prune unused Docker objects]([LINK_URL_13]) documentation. If you are using other platforms, such as Kubernetes, please refer to their official documentation.\n\n### Getting cmd/shell access inside a container\nRun this command to start a powershell or cmd process inside the container. This can be used to quickly read the file system inside the containers. Use commands [CODE_BLOCK_1] or[CODE_BLOCK_2].\n\nAre you not sure if you are inside or outside a container? Type `",
  "[INLINE_CODE_38]": "`winver`",
  "[INLINE_CODE_39]": "` in the Windows Command Prompt. If you are inside a container it will look like this: \n\n[CODE_BLOCK_3] \n\nIf you are on the host the **About Windows** pop-up will show.\nIf you want to exit the powershell or cmd session in the container, to get back to the host, use Ctrl+C.\n\n### Reading log output\n\n1. Open a PowerShell console in admin mode. \n2. Go to the folder where the docker-compose.yml file lives and execute one of the following commands.\n- Log output type `",
  "[INLINE_CODE_40]": "` in the command-line. \n- Or when you want to output this to a file containerlogs.log type `",
  "[INLINE_CODE_41]": "`Docker-compose logs -t -n 5000 > containerlogs.log`",
  "[INLINE_CODE_42]": "`\n\n### Network\nOn startup Docker will create a virtual network on the host to which the containers are attached and get an IP address. \nYou can view existing networks in powershell with `",
  "[INLINE_CODE_43]": "`docker network ls`",
  "[INLINE_CODE_44]": "` and a specific network with `",
  "[INLINE_CODE_45]": "`docker network inspect <<network name>>`",
  "[INLINE_CODE_46]": "`. To find the network a container is in use `",
  "[INLINE_CODE_47]": "`docker inspect <<container name>>`",
  "[INLINE_CODE_48]": "` (and `",
  "[INLINE_CODE_49]": "`docker ps`",
  "[INLINE_CODE_50]": "` to find container names).\n\nAll three Uptrends Docker containers (Checkpoint, CheckpointRelay, TransactionProcessor) need to be able to connect to Uptrends via probemaster1.uptrends.com and probemaster2.uptrends.com. Both the Checkpoint and CheckpointRelay containers need to be able to connect to the customers applications under test.\n\n### DNS issues\n\nA common cause of connectivity issues is DNS resolving. For troubleshooting you can follow these steps:\n\n1. On the host, `",
  "[INLINE_CODE_51]": "`nslookup probemaster1.uptrends.com`",
  "[INLINE_CODE_52]": "` should return 95.211.70.204. If it doesn't the containers will not be able to connect to Uptrends.\n\n2. Given that the containers are running (check with `",
  "[INLINE_CODE_53]": "`docker ps`",
  "[INLINE_CODE_54]": "`), enter a powershell session in a container: `",
  "[INLINE_CODE_55]": "`docker exec -i Checkpoint powershell.exe`",
  "[INLINE_CODE_56]": "`.\n\n3. Once inside the container, `",
  "[INLINE_CODE_57]": "`nslookup probemaster1.uptrends.com`",
  "[INLINE_CODE_58]": "` should again return 95.211.70.204. If that succeeds the container should be able to reach the Uptrends cloud platform.\n\n4. Try the same for a hostname of an internal application, like `",
  "[INLINE_CODE_59]": "`nslookup <<name application>>`",
  "[INLINE_CODE_60]": "`, and verify the returned IP. If this times out, the application will not be reachable from the container (and thus cannot be monitored).\n\nIf any of these steps fail, you can try:\n\n- Compare ipconfig from the host and from inside a container (`",
  "[INLINE_CODE_61]": "`docker exec -i Checkpoint powershell.exe`",
  "[INLINE_CODE_62]": "` to get a powershell session inside the Checkpoint container) and verify the configured DNS server(s).\n\nTry specifying a public DNS like 8.8.8.8 (Google) when doing a nslookup like so: `",
  "[INLINE_CODE_63]": "`nslookup probemaster1.uptrends.com 8.8.8.8`"
}